<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Word search game</title>
  <link rel="stylesheet" href="css/wordsearch.css"/>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="../../css/common.scss">
  <meta name="theme-color" content="#fafafa">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/petite-vue/0.4.1/petite-vue.umd.js"></script>
</head>
<body>
<div class="container" id="app" v-scope @vue:mounted="onMounted">
  <div id="splash" class="animate__animated" :class="screen === 'splash' ? animateIn : animateOut">
    <div class="game-content">
      <div class="game-bg">
        <img src="./assets/splash.png" class="responsive-img" alt="splash screen">
        <div style="display: flex; justify-content: space-between">
          <div class="button">
            <div class="generic-button" @click="screen = 'instructions'; showInstructions = true">
              <div class="spot-counter-text">How to Play</div>
            </div>
          </div>
          <div class="button">
            <div class="generic-button" @click="restartGame">
              <div class="spot-counter-text">Start Game</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="instructions" class="animate__animated" v-show="showInstructions"
  :class="screen === 'instructions' ? animateIn : animateOut">
    <div class="game-content">
      <div class="game-bg">
        <div class="header">
          <img src="./assets/heading.png" class="responsive-img" alt="splash screen">
        </div>
        <div class="bodytext">
          <p>How to Play:
          <ol>
            <li>The game starts with 10 words hidden in a grid of letters.</li>
            <li>Words are hidden vertically, horizontally and diagonally.</li>
            <li>Find each word listed at the top.</li>
            <li>Found a word? Tap and drag to colour it in.</li>
            <li>The game ends when all 10 words have been found.</li>
          </ol>
        </div>
        <div class="button">
          <div class="generic-button" @click="restartGame">
            <div class="spot-counter-text">Start Game</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="game" class="animate__animated" v-show="showGame" :class="screen === 'game' ? animateIn : animateOut">
    <section id="ws-area"></section>
    <div style="display: flex; justify-content: space-between">
      <div class="generic-button">
        <div class="spot-counter-text">{{formatTime}}</div>
      </div>
      <div class="word-list">
        <div class="word-container" v-for="word in wordList">
          {{word}}
        </div>
      </div>
    </div>
  </div>
  <div id="thanks" class="animate__animated" v-show="showThanks" :class="screen === 'thanks' ? animateIn : animateOut">
    <div class="thanks-content">
      <div class="header">
        <img src="./assets/thanks.png" class="responsive-img" alt="splash screen">
      </div>
      <div class="bodytext">
        <p>THANKS FOR PLAYING</p>
        <p>Your time was: {{formatTime}}</p>
        <p>Well Done!</p>
      </div>
      <div class="button">
        <div class="generic-button" @click="restartGame">
          <div class="spot-counter-text">Play Again?</div>
        </div>
      </div>
    </div>
    <div class="logo">
      <img src="./assets/ls3-logo.png" class="responsive-img" alt="splash screen">
    </div>
  </div>
</div>
<script type="module" lang="ts">
  PetiteVue.createApp({
    screen: 'splash',
    itemsTotal: 0,
    itemsFound: 0,
    screenWidth: 0,
    animateIn: 'animate__rollIn',
    animateOut: 'animate__rollOut no-pointer-events',
    showGame: false,
    showThanks: false,
    showInstructions: false,
    state: {
      gameStarted: false,
      totalTime: 0,
      loop: null
    },
    wordList: [],
    onMounted() {
      fetch("https://jgnyb3xew6.execute-api.af-south-1.amazonaws.com/latest/word")
        .then(response => response.json())
        .then(data => {
          this.wordList = data['wordlist'];
        });

      window.addEventListener("message", (event) => {
        if (event.data === 'ws-done') {
          clearInterval(this.state.loop);
          setTimeout(() => {
            this.showThanks = true;
            this.screen = 'thanks';
          }, 1200);
        }
      })
    },

    convertScreenSpaceToPixels(percent) {
      return this.screenWidth * percent / 100;
    },
    get formatTime() {
      const minutes = Math.floor(this.state.totalTime / 60)
      const seconds = this.state.totalTime % 60
      return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`
    },
    restartGame() {
      clearInterval(this.state.loop);

      this.state.loop = null;
      this.screen = 'game';
      this.showGame = true;
      this.state.totalTime = 0;
      document.getElementById('ws-area').innerHTML = '';
     let collection = document.getElementsByClassName('word-container');
     for (let x=0; x<collection.length; x++) {
       collection[x].classList.remove('solved');
     }
      let gameAreaEl = document.getElementById('ws-area');
      let gameobj = gameAreaEl.wordSearch({words: this.wordList, gridSize: 10});
      this.state.loop = setInterval(() => {
        this.state.totalTime++;
      }, 1000);

    },
    get formatTime() {
      const minutes = Math.floor(this.state.totalTime / 60)
      const seconds = this.state.totalTime % 60
      return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`
    }

  }).mount('#app')
</script>
<script src="js/utility.js"></script>
<script src="js/wordsearch.js"></script>
<script src="js/modernizr-custom.js"></script>
<script type="text/javascript">
  window.onload = function() {
    window.parent.postMessage('ready');
  }
</script>
</body>
</html>
